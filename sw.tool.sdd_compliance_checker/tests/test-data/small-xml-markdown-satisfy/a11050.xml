<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.17">
  <compounddef id="a11050" kind="page">
    <compoundname>SectionSoftwareUnitInteraction</compoundname>
    <title>Software Unit Interaction</title>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<sect1 id="a11050_1SoftwareUnitInteraction">
<title>Software Unit Interaction</title>
<para><linebreak/>
</para>
<para>The diagram below shows the relevant use cases for ComServerFlex:<linebreak/>
</para>
<para><linebreak/>
 <plantuml>!include plantuml/UCD_ComServFlex.plantuml</plantuml>
 <linebreak/>
</para>
<para>Requirement allocation to the ComServerFlex use cases:</para>
<para><table rows="25" cols="4"><row>
<entry thead="yes"><para><bold>Use case</bold> </para>
</entry><entry thead="yes"><para>SWR </para>
</entry><entry thead="yes"><para>ICAS1 </para>
</entry><entry thead="yes"><para>ICAS1evo  </para>
</entry></row>
<row>
<entry thead="no"><para>Startup </para>
</entry><entry thead="no"><para></para>
</entry><entry thead="no"><para>x </para>
</entry><entry thead="no"><para>x  </para>
</entry></row>
<row>
<entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry></row>
<row>
<entry thead="no"><para>Signal to Service transformation </para>
</entry><entry thead="no"><para>SWR_L2_HK_ComServ_AD_443 </para>
</entry><entry thead="no"><para>x </para>
</entry><entry thead="no"><para>x  </para>
</entry></row>
<row>
<entry thead="no"><para></para>
</entry><entry thead="no"><para>SWR_L2_HK_ComServ_AD_453 </para>
</entry><entry thead="no"><para>x </para>
</entry><entry thead="no"><para>x  </para>
</entry></row>
<row>
<entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry></row>
<row>
<entry thead="no"><para>Signal to SOME/IP transformation </para>
</entry><entry thead="no"><para>SWR_L2_HK_ComServ_AD_445 </para>
</entry><entry thead="no"><para>x </para>
</entry><entry thead="no"><para>x  </para>
</entry></row>
<row>
<entry thead="no"><para></para>
</entry><entry thead="no"><para>SWR_L2_HK_ComServ_AD_450 </para>
</entry><entry thead="no"><para>x </para>
</entry><entry thead="no"><para>x  </para>
</entry></row>
<row>
<entry thead="no"><para></para>
</entry><entry thead="no"><para>SWR_L2_HK_ComServ_AD_504 </para>
</entry><entry thead="no"><para>x </para>
</entry><entry thead="no"><para>x  </para>
</entry></row>
<row>
<entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry></row>
<row>
<entry thead="no"><para>Signal to VIWI transformation </para>
</entry><entry thead="no"><para>SWR_L2_HK_ComServ_AD_447 </para>
</entry><entry thead="no"><para>x </para>
</entry><entry thead="no"><para>x  </para>
</entry></row>
<row>
<entry thead="no"><para></para>
</entry><entry thead="no"><para>SWR_L2_HK_ComServ_AD_452 </para>
</entry><entry thead="no"><para>x </para>
</entry><entry thead="no"><para>x  </para>
</entry></row>
<row>
<entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry></row>
<row>
<entry thead="no"><para>Handle signal timeout </para>
</entry><entry thead="no"><para></para>
</entry><entry thead="no"><para>x </para>
</entry><entry thead="no"><para>x  </para>
</entry></row>
<row>
<entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry></row>
<row>
<entry thead="no"><para>Service to Signal transformation </para>
</entry><entry thead="no"><para>SWR_L2_HK_ComServ_AD_444 </para>
</entry><entry thead="no"><para>x </para>
</entry><entry thead="no"><para>x  </para>
</entry></row>
<row>
<entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry></row>
<row>
<entry thead="no"><para>SOME/IP to Signal transformation </para>
</entry><entry thead="no"><para>SWR_L2_HK_ComServ_AD_446 </para>
</entry><entry thead="no"><para>x </para>
</entry><entry thead="no"><para>x  </para>
</entry></row>
<row>
<entry thead="no"><para></para>
</entry><entry thead="no"><para>SWR_L2_HK_ComServ_AD_449 </para>
</entry><entry thead="no"><para>x </para>
</entry><entry thead="no"><para>x  </para>
</entry></row>
<row>
<entry thead="no"><para></para>
</entry><entry thead="no"><para>SWR_L2_HK_ComServ_AD_505 </para>
</entry><entry thead="no"><para>x </para>
</entry><entry thead="no"><para>x  </para>
</entry></row>
<row>
<entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry></row>
<row>
<entry thead="no"><para>VIWI to Signal transformation </para>
</entry><entry thead="no"><para>SWR_L2_HK_ComServ_AD_448 </para>
</entry><entry thead="no"><para>x </para>
</entry><entry thead="no"><para>x  </para>
</entry></row>
<row>
<entry thead="no"><para></para>
</entry><entry thead="no"><para>SWR_L2_HK_ComServ_AD_451 </para>
</entry><entry thead="no"><para>x </para>
</entry><entry thead="no"><para>x  </para>
</entry></row>
<row>
<entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry><entry thead="no"><para></para>
</entry></row>
<row>
<entry thead="no"><para>Handle service loss </para>
</entry><entry thead="no"><para></para>
</entry><entry thead="no"><para>x </para>
</entry><entry thead="no"><para>x  </para>
</entry></row>
</table>
</para>
<para><xrefsect id="a04883_1_satisfy000001"><xreftitle>Satisfies requirement</xreftitle><xrefdescription><para>SWR_L2_HK_ComServ_AD_443 </para>
<para>SWR_L2_HK_ComServ_AD_453 </para>
<para>SWR_L2_HK_ComServ_AD_445 </para>
<para>SWR_L2_HK_ComServ_AD_450 </para>
<para>SWR_L2_HK_ComServ_AD_504 </para>
<para>SWR_L2_HK_ComServ_AD_447 </para>
<para>SWR_L2_HK_ComServ_AD_452 </para>
<para>SWR_L2_HK_ComServ_AD_444 </para>
<para>SWR_L2_HK_ComServ_AD_446 </para>
<para>SWR_L2_HK_ComServ_AD_449 </para>
<para>SWR_L2_HK_ComServ_AD_505 </para>
<para>SWR_L2_HK_ComServ_AD_448 </para>
<para>SWR_L2_HK_ComServ_AD_451</para>
</xrefdescription></xrefsect></para>
<para><linebreak/>
 The following sequence diagrams show their realization.<linebreak/>
 <linebreak/>
</para>
</sect1>
<sect1 id="a11050_1startup">
<title>Startup</title>
<para>Upon startup of the <bold>ICAS1</bold>, the <emphasis>Execution Manager</emphasis> on the <emphasis>Housekeeping</emphasis> partition on the <emphasis>RCAR</emphasis> microcontroller starts the <emphasis>ComServFlex</emphasis> application.</para>
<para>The <emphasis>ComServFlex</emphasis> initializes several <emphasis>ara</emphasis> components and starts the services.</para>
<para>After all services have been started, the <emphasis>ComServFlex</emphasis> enters an endless loop to:<itemizedlist>
<listitem><para>calls the <emphasis>ASR::RTE</emphasis> (<bold>AUTOSAR Classic</bold>) cyclically every 10 ms</para>
</listitem><listitem><para>triggers the <emphasis>ARA::PHM</emphasis> watchdog cyclically every 500 ms</para>
</listitem></itemizedlist>
</para>
<para><linebreak/>
 <linebreak/>
 <plantuml>!include plantuml/SQD_Startup.plantuml!0</plantuml>
 <linebreak/>
</para>
<sect2 id="a11050_1start_service_construction">
<title>Start Service Construction</title>
<para>During service construction the <emphasis>ComServFlex</emphasis> does the following:<itemizedlist>
<listitem><para>create <emphasis>SOME/IP</emphasis> signal to service map</para>
</listitem><listitem><para>subscribe and listen to all services</para>
</listitem></itemizedlist>
</para>
<para><linebreak/>
 <linebreak/>
 <plantuml>!include plantuml/SQD_StartServiceConstruction.plantuml</plantuml>
 <linebreak/>
</para>
</sect2>
</sect1>
<sect1 id="a11050_1signal2someip">
<title>Signal2SOME/IP</title>
<para>The <emphasis>Signal2SOME/IP</emphasis> handling in the <emphasis>ComServFlex</emphasis> application is implemented using C++ template classes.</para>
<para>The <emphasis>Signal2SOME/IP</emphasis> handling in <emphasis>ComServFlex</emphasis> does the following:</para>
<para><itemizedlist>
<listitem><para><bold>Regular Usecase</bold>: Processing signals:<itemizedlist>
<listitem><para>The <emphasis>Signal2SOME/IP</emphasis> handling in the <emphasis>ComServFlex</emphasis> application is triggered each time a <emphasis>PDU</emphasis> (<emphasis>SOME/IP</emphasis> service properties can consist of information from one or many <emphasis>PDUs</emphasis>) is received from the <emphasis>ASR Stack</emphasis> (<bold>AUTOSAR Classic</bold>):<itemizedlist>
<listitem><para>find the list of field vectors for the given <emphasis>PDU</emphasis></para>
</listitem><listitem><para>iterate through all field vectors in the list<itemizedlist>
<listitem><para>iterate through all structs in the vector<itemizedlist>
<listitem><para>update all struct members</para>
</listitem></itemizedlist>
</para>
</listitem></itemizedlist>
</para>
</listitem><listitem><para>if initial call or the field vector has changed:<itemizedlist>
<listitem><para>send updated field vector to the <emphasis>ARA::COM</emphasis> (<bold>AUTOSAR Adaptive</bold>) <emphasis>SOME/IP</emphasis> stack</para>
</listitem></itemizedlist>
</para>
</listitem></itemizedlist>
</para>
</listitem></itemizedlist>
</para>
</listitem><listitem><para><bold>Regular Usecase: PDU in timeout Usecase</bold>: Signal Loss<itemizedlist>
<listitem><para>this usecase is handled in <emphasis><ref refid="a05164" kindref="compound">perfect_timing</ref></emphasis> in the <emphasis>Timeout::CyclicCall</emphasis> which will call the respective <emphasis>callBack</emphasis> function (<emphasis>SomeIpService::OnPduReceived(pduNo, timeout)</emphasis>) immediately if <emphasis>Timeout::Refresh()</emphasis> has not been triggered (see chapter Perfect Timing: Timeout Class)<itemizedlist>
<listitem><para><emphasis>UpdateFieldStruct</emphasis> deletes respective members<itemizedlist>
<listitem><para>IF all members are empty, struct is empty</para>
</listitem></itemizedlist>
</para>
</listitem><listitem><para><emphasis>WriteToStruct</emphasis> deletes respective properties in struct</para>
</listitem></itemizedlist>
</para>
</listitem></itemizedlist>
</para>
</listitem><listitem><para><bold>Special Usecase</bold>: Remote <emphasis>SOME/IP</emphasis> client sends <emphasis>SOME/IP</emphasis> property to local <emphasis>SOME/IP</emphasis> server, which subsequently translates the <emphasis>SOME/IP</emphasis> property into signal(s) (combination of a signal sender and a SOME/IP server):<itemizedlist>
<listitem><para>the <emphasis>ARA::COM</emphasis> stack (<bold>AUTOSAR Adaptive</bold>) notifies the <emphasis>SOME/IP</emphasis> client that a new <emphasis>SOME/IP</emphasis> event has been received</para>
</listitem><listitem><para>update the <emphasis>SOME/IP</emphasis> field vector with the newly received <emphasis>SOME/IP</emphasis> event</para>
</listitem><listitem><para><emphasis>WriteToSignal()</emphasis> updates the <emphasis>ASR Stack</emphasis> (<bold>AUTOSAR Classic</bold>) with the updated signal(s) derived from <emphasis>SOME/IP</emphasis> field vector<itemizedlist>
<listitem><para>the <emphasis>ASR Stack</emphasis> internally transmits the <emphasis>PDU</emphasis>(s) cyclically based on configuration, even if no <emphasis>PDU</emphasis> update occurred</para>
</listitem></itemizedlist>
</para>
</listitem></itemizedlist>
</para>
</listitem></itemizedlist>
</para>
<para><linebreak/>
 <linebreak/>
 <plantuml>!include plantuml/SQD_SignalToSomeIpService.plantuml!0</plantuml>
 <linebreak/>
</para>
<sect2 id="a11050_1signal2someip_opr">
<title>Signal2SOME/IP: SQD_Signal2SOME/IP_SomeIpService_OnPduReceived</title>
<para><linebreak/>
 <plantuml>!include plantuml/SQD_SignalToSomeIpService.plantuml!1</plantuml>
 <linebreak/>
</para>
</sect2>
</sect1>
<sect1 id="a11050_1someip2signal">
<title>SOME/IP2Signal</title>
<para>The <emphasis>SOME/IP2Signal</emphasis> handling in the <emphasis>ComServFlex</emphasis> application is implemented using C++ template classes.</para>
<para>The <emphasis>SOME/IP2Signal</emphasis> handling in the <emphasis>ComServFlex</emphasis> does the following:<itemizedlist>
<listitem><para><bold>Find the SOME/IP Service</bold><itemizedlist>
<listitem><para>each SOME/IP client uses the service proxy to find the requested SOME/IP service</para>
</listitem></itemizedlist>
</para>
</listitem></itemizedlist>
</para>
<para><linebreak/>
 <plantuml>!include plantuml/SQD_SomeIpServiceToSignal.plantuml!0</plantuml>
 <linebreak/>
</para>
<para><itemizedlist>
<listitem><para><bold>Service discovery</bold>:<itemizedlist>
<listitem><para>during startup, the <emphasis>ComServFlex</emphasis> registers a callback (OnServiceFound()) for each <emphasis>SOME/IP</emphasis> service via <emphasis>FindService()</emphasis></para>
</listitem><listitem><para>the <emphasis>ARA::COM</emphasis> (<bold>AUTOSAR Adaptive</bold>) stack notifies the <emphasis>ComServFlex</emphasis> upon service status change via the registered <emphasis>OnServiceFound()</emphasis> callback</para>
</listitem><listitem><para>the <emphasis>ComServFlex</emphasis> <emphasis>SOME/IP client</emphasis> calls the <emphasis>ARA::COM</emphasis> (<bold>AUTOSAR Adaptive</bold>) service proxy to find the required service and register its callback</para>
</listitem><listitem><para>after <emphasis>ARA::COM</emphasis> notified the availability of a service, the <emphasis>ComServFlex</emphasis> starts the service by registering a <emphasis>SOME/IP client</emphasis> proxy</para>
</listitem><listitem><para><bold>Service Loss</bold>:<itemizedlist>
<listitem><para>set PDU transmission mode to FALSE</para>
</listitem><listitem><para>the <emphasis>ASR stack</emphasis> (<bold>AUTOSAR Classic</bold>) stops sending the respective <emphasis>PDUs</emphasis></para>
</listitem></itemizedlist>
</para>
</listitem></itemizedlist>
</para>
</listitem></itemizedlist>
</para>
<para><linebreak/>
 <plantuml>!include plantuml/SQD_SomeIpServiceToSignal.plantuml!1</plantuml>
 <linebreak/>
</para>
<para><itemizedlist>
<listitem><para><bold>Regular Usecase</bold>: Service Struct Members Have Changed:<itemizedlist>
<listitem><para>the <emphasis>ARA::COM</emphasis> stack (<bold>AUTOSAR Adaptive</bold>) notifies the <emphasis>SOME/IP</emphasis> client that a new <emphasis>SOME/IP</emphasis> event has been received<itemizedlist>
<listitem><para>based on the mapping of <emphasis>PDU</emphasis> id and <emphasis>SOME/IP</emphasis> struct, the <emphasis>ComServFlex</emphasis> updates the respective <emphasis>PDU</emphasis> with the newly received <emphasis>SOME/IP</emphasis> event<itemizedlist>
<listitem><para><emphasis>GetTxPdus()</emphasis> iterates over all members of the updated <emphasis>SOME/IP</emphasis> struct to find the respective <emphasis>PDU</emphasis>(s)</para>
</listitem></itemizedlist>
</para>
</listitem><listitem><para><emphasis>WriteToSignal()</emphasis> updates the <emphasis>ASR Stack</emphasis> (<bold>AUTOSAR Classic</bold>) with the updated <emphasis>SOME/IP</emphasis> struct<itemizedlist>
<listitem><para>the <emphasis>ASR Stack</emphasis> internally transmits the <emphasis>PDU</emphasis>(s) cyclically based on configuration, even if no <emphasis>PDU</emphasis> update occurred</para>
</listitem></itemizedlist>
</para>
</listitem></itemizedlist>
</para>
</listitem></itemizedlist>
</para>
</listitem></itemizedlist>
</para>
<para><linebreak/>
 <plantuml>!include plantuml/SQD_SomeIpServiceToSignal.plantuml!2</plantuml>
 <linebreak/>
</para>
<para><itemizedlist>
<listitem><para><bold>Special Usecase</bold>: Signal processing (applies to <emphasis>SOME/IP</emphasis> client which use <emphasis><ref refid="a08828" kindref="compound">SomeIpProxyField</ref></emphasis> to act in the opposite direction to send signal information to the remote <emphasis>SOME/IP</emphasis> server of the respective <emphasis>SOME/IP</emphasis> service)<itemizedlist>
<listitem><para><emphasis>SOME/IP</emphasis> client receives a signal via PDU from the <emphasis>ASR Stack</emphasis> (<bold>AUTOSAR Classic</bold>) and does the following:<itemizedlist>
<listitem><para>translates the received signal into <emphasis>SOME/IP</emphasis> property</para>
</listitem><listitem><para>sends <emphasis>SOME/IP</emphasis> property to remote <emphasis>SOME/IP</emphasis> server via <emphasis>ARA::COM</emphasis> (<bold>AUTOSAR Adaptive</bold>) upon change</para>
</listitem></itemizedlist>
</para>
</listitem></itemizedlist>
</para>
</listitem></itemizedlist>
</para>
<para><linebreak/>
 <plantuml>!include plantuml/SQD_SomeIpServiceToSignal.plantuml!3</plantuml>
 <linebreak/>
</para>
</sect1>
<sect1 id="a11050_1signal2viwi">
<title>Signal2VIWI</title>
<para>Different to the SOME/IP services, which are based on a template class hierarchy, the <emphasis>Signal2VIWI</emphasis> implementation follows a defined pattern.<linebreak/>
 The sequence diagrams below show the generic implementation of a VIWI service using &lt;<emphasis>placeholders</emphasis>&gt; for the specific VIWI elements.<linebreak/>
 The &lt;<emphasis>placeholders</emphasis>&gt; used in the diagrams are: <linebreak/>
</para>
<para><table rows="16" cols="3"><row>
<entry thead="yes"><para>Placeholder </para>
</entry><entry thead="yes"><para>Description </para>
</entry><entry thead="yes"><para>Examples  </para>
</entry></row>
<row>
<entry thead="no"><para>&lt;<emphasis>Service</emphasis>&gt; </para>
</entry><entry thead="no"><para>the name of the VIWI Service class or instance (uppercase) </para>
</entry><entry thead="no"><para>&quot;RollingAbility&quot;  </para>
</entry></row>
<row>
<entry thead="no"><para>&lt;<emphasis>service</emphasis>&gt; </para>
</entry><entry thead="no"><para>the name of the VIWI Service (uppercase) </para>
</entry><entry thead="no"><para>&quot;rolling_ability&quot;  </para>
</entry></row>
<row>
<entry thead="no"><para>&lt;<emphasis>Object</emphasis>&gt; </para>
</entry><entry thead="no"><para>the Object name of a resource </para>
</entry><entry thead="no"><para>&quot;NotificationObject&quot;  </para>
</entry></row>
<row>
<entry thead="no"><para>&lt;<emphasis>KeyProperty</emphasis>&gt; </para>
</entry><entry thead="no"><para>the key property of an object </para>
</entry><entry thead="no"><para>&quot;Type&quot;  </para>
</entry></row>
<row>
<entry thead="no"><para>&lt;<emphasis>keyvalue</emphasis>&gt; </para>
</entry><entry thead="no"><para>the key value of an object </para>
</entry><entry thead="no"><para>a number e.g. 0, 1, ...  </para>
</entry></row>
<row>
<entry thead="no"><para>&lt;<emphasis>viwikeyvalue</emphasis>&gt; </para>
</entry><entry thead="no"><para>the VIWI keyvalue </para>
</entry><entry thead="no"><para>&quot;vehicleLeavingWarning&quot;  </para>
</entry></row>
<row>
<entry thead="no"><para>&lt;<emphasis>Property</emphasis>&gt; </para>
</entry><entry thead="no"><para>the name of a Property </para>
</entry><entry thead="no"><para>&quot;Value&quot;  </para>
</entry></row>
<row>
<entry thead="no"><para>&lt;<emphasis>propertyValue</emphasis>&gt; </para>
</entry><entry thead="no"><para>the current value of a Property </para>
</entry><entry thead="no"><para>typically a string or a number  </para>
</entry></row>
<row>
<entry thead="no"><para>&lt;<emphasis>staticvalue</emphasis>&gt; </para>
</entry><entry thead="no"><para>the static value of a Property </para>
</entry><entry thead="no"><para>typically a string or a number  </para>
</entry></row>
<row>
<entry thead="no"><para>&lt;<emphasis>PDU</emphasis>&gt; </para>
</entry><entry thead="no"><para>an abbreviation for the PDU name </para>
</entry><entry thead="no"><para>&quot;VLK_1&quot;  </para>
</entry></row>
<row>
<entry thead="no"><para>&lt;<emphasis>ASR_PDU_ID</emphasis>&gt; </para>
</entry><entry thead="no"><para>the id of a PDU defined by ASR stack </para>
</entry><entry thead="no"><para>&quot;ComConf_ComIPdu_PDUdTuPdu_VLK_1_535R&quot;  </para>
</entry></row>
<row>
<entry thead="no"><para>&lt;<emphasis>Signal</emphasis>&gt; </para>
</entry><entry thead="no"><para>the name of a Signal received or send to ASR stack </para>
</entry><entry thead="no"><para>&quot;VLK_VLW_Anf&quot;  </para>
</entry></row>
<row>
<entry thead="no"><para>&lt;<emphasis>ASR_signal_id</emphasis>&gt; </para>
</entry><entry thead="no"><para>the Signal identifier generated by the ASR stack </para>
</entry><entry thead="no"><para>&quot;ComConf_ComSignal_SGComServFlex_Inport_Get_VLK_Popup_state_1033T&quot;  </para>
</entry></row>
<row>
<entry thead="no"><para>&lt;<emphasis>version</emphasis>&gt; </para>
</entry><entry thead="no"><para>the version number of the VIWI service (from JSON file) </para>
</entry><entry thead="no"><para>&quot;0.2.2&quot;  </para>
</entry></row>
<row>
<entry thead="no"><para>&lt;<emphasis>calculationMethod</emphasis>&gt; </para>
</entry><entry thead="no"><para>the calculation method defined in <emphasis>ServiceSpecification</emphasis> </para>
</entry><entry thead="no"><para>signalValue  </para>
</entry></row>
</table>
<linebreak/>
 <bold>Note:</bold> The examples above are derived from RollingAbility Service (ID 0x600A) with:<itemizedlist>
<listitem><para>Service Name: &quot;RollingAbility&quot;</para>
</listitem><listitem><para>Resource Name: &quot;notifications&quot;</para>
</listitem><listitem><para>KeyProperty: &quot;type&quot;</para>
</listitem><listitem><para>Some/IP Key Value: &quot;1&quot;</para>
</listitem><listitem><para>VIWI KeyValue: &quot;vehicleLeavingWarning&quot;</para>
</listitem><listitem><para>Property Name: &quot;value&quot; <linebreak/>
 (see also: &quot;MEB_ICAS1_ServiceSpecification_ComServ_V10.07.05F_V2.xlsx&quot;) <linebreak/>
 <linebreak/>
</para>
</listitem></itemizedlist>
</para>
<sect2 id="a11050_1signal2viwi_service_construction">
<title>VIWI Service Construction</title>
<para>All VIWI services will be created after startup (see also <ref refid="a11050_1start_service_construction" kindref="member">Start Service Construction</ref>). <linebreak/>
 <linebreak/>
 <plantuml>!include plantuml/SQD_SignalToVIWI.plantuml!0</plantuml>
 <linebreak/>
 <linebreak/>
 <plantuml>!include plantuml/SQD_SignalToVIWI.plantuml!1</plantuml>
 <linebreak/>
</para>
</sect2>
<sect2 id="a11050_1signal2viwi_on_pdu_received">
<title>VIWI Service PDU Handler</title>
<para>The <emphasis>Signal2VIWI</emphasis> handling in the <emphasis>ComServFlex</emphasis> application is initiated on <emphasis>PDU</emphasis> reception from <emphasis>ASR Stack</emphasis> (<bold>AUTOSAR Classic</bold>) with the following tasks:<itemizedlist>
<listitem><para>initialize the <emphasis>VIWI</emphasis> service object, if not already done</para>
</listitem><listitem><para>check if the received PDU applies to the <emphasis>VIWI</emphasis> service</para>
</listitem><listitem><para>register the callback with <emphasis><ref refid="a05164" kindref="compound">perfect_timing</ref></emphasis> <emphasis>PeriodicCall</emphasis> (see chapter <bold>Perfect Timing</bold> for details):<itemizedlist>
<listitem><para>update and send <emphasis>VIWI</emphasis> service objects to <emphasis>ARA::REST</emphasis> <emphasis>VIWI</emphasis> stack upon change <linebreak/>
 <linebreak/>
 <plantuml>!include plantuml/SQD_SignalToVIWI.plantuml!2</plantuml>
 <linebreak/>
</para>
</listitem></itemizedlist>
</para>
</listitem></itemizedlist>
</para>
</sect2>
<sect2 id="a11050_1signal2viwi_init_objects">
<title>VIWI Service Object Initialization</title>
<para>The <emphasis>InitOjects()</emphasis> method of a VIWI service:<itemizedlist>
<listitem><para>creates all required resource objects and assigns a VIWI key value to it</para>
</listitem><listitem><para>sets the value of the properties (e.g. for static values or properties which shall be filled by default)</para>
</listitem><listitem><para>removes unnecessary properties from objects</para>
</listitem><listitem><para>starts objects which need to be provided immediately after startup without having received any related signal</para>
</listitem><listitem><para>installs a POST update callback for properties supporting the POST method</para>
</listitem></itemizedlist>
</para>
<para><bold>SQD_VIWIService_InitObjects</bold> <linebreak/>
 <plantuml>!include plantuml/SQD_SignalToVIWI.plantuml!3</plantuml>
 <linebreak/>
</para>
</sect2>
<sect2 id="a11050_1signal2viwi_periodic_call">
<title>VIWI Service Signal Monitoring</title>
<para>Due to performance constraints, the VIWI properties are not updated immediately on signal change but on regular base as defined together with VW using a polling mechanism.<linebreak/>
 <linebreak/>
 The <emphasis>PeriodicCall</emphasis> callback function (which is created for each supported PDU):<itemizedlist>
<listitem><para>checks if any signal in the PDU has changed</para>
</listitem><listitem><para>updates the properties of the VIWI objects using the applicable calculation methods</para>
</listitem><listitem><para>adds the objects to the server if not yet done before</para>
</listitem><listitem><para>updates the VIWI objects on the server side</para>
</listitem></itemizedlist>
</para>
<para><bold>SQD_VIWIService_PDU_Handler</bold> <linebreak/>
 <plantuml>!include plantuml/SQD_SignalToVIWI.plantuml!4</plantuml>
 <linebreak/>
</para>
</sect2>
<sect2 id="a11050_1signal2viwi_has_signal_changed">
<title>VIWI Service PDU signal comparison</title>
<para>The <bold>HasSignalChanged</bold> function checks if the signal in the PDU has changed</para>
<para><bold>SQD_VIWI_Service_HasSignalChanged</bold> <linebreak/>
 <plantuml>!include plantuml/SQD_SignalToVIWI.plantuml!5</plantuml>
 <linebreak/>
</para>
</sect2>
<sect2 id="a11050_1signal2viwi_set_signal_value">
<title>VIWI Service PDU signal comparison and setting signal as VIWI value</title>
<para>The <bold>SetSignalValue</bold> function<itemizedlist>
<listitem><para>checks if the signal in the PDU has changed</para>
</listitem><listitem><para>sets the changed signal as VIWI value in a VIWI object</para>
</listitem></itemizedlist>
</para>
<para><bold>SQD_VIWI_Service_SetSignalValue</bold> <linebreak/>
 <plantuml>!include plantuml/SQD_SignalToVIWI.plantuml!6</plantuml>
 <linebreak/>
</para>
</sect2>
<sect2 id="a11050_1signal2viwi_get_rx_pdus">
<title>VIWI Service get received PDUs</title>
<para>The <bold>GetRxPdus</bold> function returns a list of PDUs IDs on which the PDU Handler of this service deals with.</para>
<para><bold>SQD_VIWI_Service_GetRxPdus</bold> <linebreak/>
 <plantuml>!include plantuml/SQD_SignalToVIWI.plantuml!8</plantuml>
 <linebreak/>
</para>
</sect2>
<sect2 id="a11050_1signal2viwi_post_update">
<title>VIWI Service POST Update Handler</title>
<para>The <emphasis>POST Update</emphasis> callback function:<itemizedlist>
<listitem><para>receives the property values from the VIWI server and validates it</para>
</listitem><listitem><para>calculates the signal values using the applicable calculation methods</para>
</listitem><listitem><para>sends the updates signals to the ASR stack</para>
</listitem></itemizedlist>
</para>
<para><bold>SQD_VIWI_Service_PostUpdateCallback</bold> <linebreak/>
 <plantuml>!include plantuml/SQD_SignalToVIWI.plantuml!7</plantuml>
 <linebreak/>
</para>
</sect2>
</sect1>
<sect1 id="a11050_1viwi2signal">
<title>VIWI2Signal</title>
<para>A <emphasis>ComServFlex</emphasis> <emphasis>VIWI</emphasis> client translates <emphasis>VIWI</emphasis> service properties received from a remote <emphasis>VIWI</emphasis> server into signals.<linebreak/>
 The <emphasis>VIWI</emphasis> client has the following tasks:<itemizedlist>
<listitem><para>Check the <emphasis>VIWI</emphasis> service registry:<itemizedlist>
<listitem><para>Start a <emphasis>PeriodicCall</emphasis> to check the available services in <emphasis>VIWI</emphasis> service registry</para>
</listitem></itemizedlist>
</para>
</listitem><listitem><para>Search for the required <emphasis>VIWI</emphasis> service instance:<itemizedlist>
<listitem><para>If the <emphasis>VIWI</emphasis> service instance is not subscribed:<itemizedlist>
<listitem><para>Start a <emphasis>PeriodicCall</emphasis> to find the required service using <emphasis>ARA::REST</emphasis> <emphasis>VIWI</emphasis> stack</para>
</listitem><listitem><para>Subscribe the <emphasis>VIWI</emphasis> service instance at the <emphasis>ARA:REST</emphasis> <emphasis>VIWI</emphasis> stack</para>
</listitem></itemizedlist>
</para>
</listitem></itemizedlist>
</para>
</listitem><listitem><para>Search for the requires <emphasis>VIWI</emphasis> element(s):<itemizedlist>
<listitem><para>For each new <emphasis>VIWI</emphasis> element:<itemizedlist>
<listitem><para>Start a <emphasis>PeriodicCall</emphasis> to register an <emphasis>eventHandler</emphasis> callback at the <emphasis>ARA::REST</emphasis> <emphasis>VIWI</emphasis> stack which will be executed if a <emphasis>VIWI</emphasis> element has been updated</para>
</listitem><listitem><para>Subscribe to the <emphasis>ARA::REST</emphasis> <emphasis>VIWI</emphasis> element</para>
</listitem></itemizedlist>
</para>
</listitem><listitem><para>If the <emphasis>VIWI</emphasis> Element already exists:<itemizedlist>
<listitem><para>Refresh <emphasis>VIWI</emphasis> element with <emphasis>ARA::REST</emphasis> <emphasis>VIWI</emphasis> stack</para>
</listitem><listitem><para>Un-subscribe to <emphasis>VIWI</emphasis> element with <emphasis>ARA::REST</emphasis> <emphasis>VIWI</emphasis> stack</para>
</listitem><listitem><para>Re-subscribe to <emphasis>VIWI</emphasis> element with <emphasis>ARA::REST</emphasis> <emphasis>VIWI</emphasis> stack <linebreak/>
 <linebreak/>
</para>
</listitem></itemizedlist>
</para>
</listitem></itemizedlist>
</para>
</listitem></itemizedlist>
</para>
<para>The sequence diagrams below show the generic implementation of a <emphasis>VIWI</emphasis> client using &lt;<emphasis>placeholders</emphasis>&gt; for the specific VIWI elements.<linebreak/>
 The &lt;<emphasis>placeholders</emphasis>&gt; used in the diagrams are: <linebreak/>
</para>
<para><table rows="8" cols="3"><row>
<entry thead="yes"><para>Placeholder </para>
</entry><entry thead="yes"><para>Description </para>
</entry><entry thead="yes"><para>Examples  </para>
</entry></row>
<row>
<entry thead="no"><para>&lt;<emphasis>Client</emphasis>&gt; </para>
</entry><entry thead="no"><para>the name of the VIWI Client class or instance (uppercase) </para>
</entry><entry thead="no"><para>&quot;SmartChargingTariff&quot;  </para>
</entry></row>
<row>
<entry thead="no"><para>&lt;<emphasis>client</emphasis>&gt; </para>
</entry><entry thead="no"><para>the name of the VIWI client (lowercase) </para>
</entry><entry thead="no"><para>&quot;smartChargingTariff&quot;  </para>
</entry></row>
<row>
<entry thead="no"><para>&lt;<emphasis>Field</emphasis>&gt; </para>
</entry><entry thead="no"><para>the name of a VIWI resource (uppercase) </para>
</entry><entry thead="no"><para>&quot;TariffDatas&quot;  </para>
</entry></row>
<row>
<entry thead="no"><para>&lt;<emphasis>field</emphasis>&gt; </para>
</entry><entry thead="no"><para>the name of a VIWI resource (lowercase) </para>
</entry><entry thead="no"><para>&quot;tariffDatas&quot;  </para>
</entry></row>
<row>
<entry thead="no"><para>&lt;<emphasis>Property</emphasis>&gt; </para>
</entry><entry thead="no"><para>the name of VIWI property (uppercase) </para>
</entry><entry thead="no"><para>&quot;PowerLimit&quot;, &quot;Duration&quot;  </para>
</entry></row>
<row>
<entry thead="no"><para>&lt;<emphasis>viwikeyvalue</emphasis>&gt; </para>
</entry><entry thead="no"><para>the VIWI keyvalue </para>
</entry><entry thead="no"><para>&quot;1&quot;  </para>
</entry></row>
<row>
<entry thead="no"><para>Com&lt;<emphasis>SignalId</emphasis>&gt; </para>
</entry><entry thead="no"><para>the signal id generated by EB TRESOS Studio </para>
</entry><entry thead="no"><para>&quot;ComConf_ComSignal_SGComServFlex_Inport_Get_SCT_GueltigkeitStart_1038T&quot;  </para>
</entry></row>
</table>
</para>
<para><linebreak/>
 <bold>Note:</bold> The examples above are taken from <bold>SmartChargingTariff</bold> (the only <emphasis>VIWI</emphasis> client for <emphasis>ComServFlex</emphasis>).<linebreak/>
 (see also: &quot;MEB_ICAS1_ServiceSpecification_ComServ_V10.07.05F_V2.xlsx&quot;) <linebreak/>
 <linebreak/>
</para>
<sect2 id="a11050_1viwi2signal_construct_service">
<title>VIWI2Signal - Service Construction</title>
<para>The constructor initializes all member variables of the client class and starts a thread which executes the client. <linebreak/>
 <plantuml>!include plantuml/SQD_VIWIToSignal.plantuml!0</plantuml>
 <linebreak/>
</para>
<para><plantuml>!include plantuml/SQD_VIWIToSignal.plantuml!1</plantuml>
 <linebreak/>
</para>
</sect2>
<sect2 id="a11050_1viwi2signal_init">
<title>VIWI2Signal - Client initialization</title>
<para>The <bold>init()</bold> method deactivates PDU transmission and calls method subscribeService(). <linebreak/>
 <plantuml>!include plantuml/SQD_VIWIToSignal.plantuml!2</plantuml>
 <linebreak/>
</para>
</sect2>
<sect2 id="a11050_1viwi2signal_subscribe_service">
<title>VIWI2Signal - Service subscription</title>
<para>The <bold>subscribeService()</bold> method contains the main loop of the <emphasis>Signal2VIWI</emphasis> implementation in <emphasis>ComServFlex</emphasis> and does the following:<itemizedlist>
<listitem><para>The main loop is triggered with a frequency of 1 sec and can be stopped externally via promise/future mechanism (i.e. destructor called)</para>
</listitem><listitem><para>The main loop checks for status change of the:<itemizedlist>
<listitem><para><emphasis>VIWI</emphasis> Registry (<ref refid="a11050_1viwi2signal_find_registry" kindref="member">VIWI2Signal - Find Registry</ref>)</para>
</listitem><listitem><para><emphasis>VIWI</emphasis> Service (<ref refid="a11050_1viwi2signal_find_service" kindref="member">VIWI2Signal - Find Service</ref>)</para>
</listitem><listitem><para><emphasis>VIWI</emphasis> Service Field(s) (<ref refid="a11050_1viwi2signal_find_field" kindref="member">VIWI2Signal - Find Field</ref>) <linebreak/>
 <plantuml>!include plantuml/SQD_VIWIToSignal.plantuml!3</plantuml>
 <linebreak/>
</para>
</listitem></itemizedlist>
</para>
</listitem></itemizedlist>
</para>
</sect2>
<sect2 id="a11050_1viwi2signal_find_registry">
<title>VIWI2Signal - Find Registry</title>
<para><linebreak/>
 <plantuml>!include plantuml/SQD_VIWIToSignal.plantuml!4</plantuml>
 <linebreak/>
</para>
</sect2>
<sect2 id="a11050_1viwi2signal_find_service">
<title>VIWI2Signal - Find Service</title>
<para><linebreak/>
 <plantuml>!include plantuml/SQD_VIWIToSignal.plantuml!5</plantuml>
 <linebreak/>
</para>
</sect2>
<sect2 id="a11050_1viwi2signal_find_field">
<title>VIWI2Signal - Find Field</title>
<para><linebreak/>
 <plantuml>!include plantuml/SQD_VIWIToSignal.plantuml!6</plantuml>
 <linebreak/>
</para>
</sect2>
<sect2 id="a11050_1viwi2signal_check_subscription_state">
<title>VIWI2Signal - Check the status of subscription</title>
<para>The helper method <bold>subscriptionStateCheck()</bold> is used to evaluate the subscription state received from <emphasis>VIWI</emphasis> stack. <linebreak/>
 <plantuml>!include plantuml/SQD_VIWIToSignal.plantuml!7</plantuml>
 <linebreak/>
</para>
<para><anchor id="a11050_1EventHandlerCallback"/> </para>
</sect2>
<sect2 id="a11050_1viwi2signal_event_handler">
<title>VIWI2Signal - Handle events (updates of service properties)</title>
<para>The <emphasis>VIWI2Signal</emphasis> <bold>eventHandler&lt;Field&gt;</bold> callback is executed after a subscribed <emphasis>VIWI</emphasis> element has been updated and does the following:<itemizedlist>
<listitem><para>If the respective <emphasis>VIWI</emphasis> service has timed out:<itemizedlist>
<listitem><para>Stop sending TX <emphasis>PDU</emphasis>(s) to the <emphasis>ASR Stack</emphasis> (<bold>AUTOSAR Classic</bold>)</para>
</listitem></itemizedlist>
</para>
</listitem><listitem><para>If the <emphasis>VIWI</emphasis> element exists:<itemizedlist>
<listitem><para>Send all corresponding signals and signal arrays to <emphasis>ASR Stack</emphasis> <linebreak/>
 <linebreak/>
 <plantuml>!include plantuml/SQD_VIWIToSignal.plantuml!8</plantuml>
 <linebreak/>
 </para>
</listitem></itemizedlist>
</para>
</listitem></itemizedlist>
</para>
</sect2>
</sect1>
    </detaileddescription>
  </compounddef>
</doxygen>
