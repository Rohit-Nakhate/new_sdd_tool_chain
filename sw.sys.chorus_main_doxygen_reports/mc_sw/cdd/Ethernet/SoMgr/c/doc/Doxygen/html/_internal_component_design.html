<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SDD_SoMgr: Internal Component Design</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SDD_SoMgr
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">index</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Internal Component Design </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="InternalComponentDesign"></a>
Internal Component Design</h1>
<p>The component is split into the following SW units: <br />
</p><ul>
<li><b>SoMgr</b> - implements the main interfaces which interact with TCP/IP.</li>
<li><b>SoMgr_Cbk</b> - contains the callbacks from TCP/IP stack.</li>
<li><b>SoMgr_Def</b> - contains the definition and default settings of the sockets provided by SoMgr functionality <br />
 <div class="image">
<img src="SoMgr_Chorus_UnitComposition.png" alt="SoMgr_Chorus_UnitComposition.png"/>
<div class="caption">
Socket Manager decomposition</div></div>
</li>
</ul>
<h1><a class="anchor" id="SW"></a>
Requirements Allocation</h1>
<p>The SW requirements are defined in chapter <b>2.17.2 - Socket Manager</b> from <b>SWR_ICAS1_BSW</b>. All the software requirements assigned to Socket Manager are satisfied by mentioned subcomponents. The software requirements can be traced on function level and it does not have any non functional requiremets.</p>
<h1><a class="anchor" id="SoftwareUnitInterfaces"></a>
Software Unit Interfaces</h1>
<p>The interfaces used internally between the SW units of this SW component are described in the following diagram: </p><div class="image">
<img src="SoMgr_InternalSoftwareUnitInterfaces.png" alt="SoMgr_InternalSoftwareUnitInterfaces.png"/>
<div class="caption">
Component internal SW unit internal interaction and interfaces</div></div>
<p>The interaction btw the Socket Manager unit and external components from Chorus is described in the next diagram: </p><div class="image">
<img src="SoMgr_ExternalSoftwareUnitInterfaces.png" alt="SoMgr_ExternalSoftwareUnitInterfaces.png"/>
<div class="caption">
SocketManager SW unit external interaction and interfaces</div></div>
<h1><a class="anchor" id="SoftwareUnitInteraction"></a>
Software Unit Interaction</h1>
<p>The software unit interaction is mentioned in the above diagram where is described the interaction of the SW units within the component and also the interaction of each SW unit with external components.</p>
<h1><a class="anchor" id="SoftwareUnitDescription_1"></a>
Dynamic Behavior</h1>
<p>The behavior of the initialization function, <a class="el" href="_so_mgr_8h.html#a128c74720b5b926ee850db9abe41c6d2">SoMgr_Init</a> , is: </p><div class="image">
<img src="seq_diagram_SoMgr_Init.png" alt="seq_diagram_SoMgr_Init.png"/>
<div class="caption">
Dynamic Behavior for SoMgr_Init </div></div>
<p>Each socket has a state machine, described below: </p><div class="image">
<img src="act_diagram_SocketStateMachine.png" alt="act_diagram_SocketStateMachine.png"/>
<div class="caption">
Socket State machine</div></div>
<h1><a class="anchor" id="SoftwareUnitDescription_2"></a>
Data flow Diagram</h1>
<p>The diagram below presents the major dataflow from the module.</p>
<div class="image">
<img src="data_flow_Doip_Req_sock_connection.png" alt="data_flow_Doip_Req_sock_connection.png"/>
<div class="caption">
DoIP Request data flow for a socket connection</div></div>
<p> <br />
<br />
</p><div class="image">
<img src="data_flow_DoIP_resp_sock_connection.png" alt="data_flow_DoIP_resp_sock_connection.png"/>
<div class="caption">
DoIP Response data flow for a socket connection</div></div>
<h2>Tasks</h2>
<p>Component has one task, <a class="el" href="_so_mgr_8h.html#a26b08ec264892fc6112b7e1ab2911e36">SoMgr_MainFunction</a>, which for the moment is EMPTY.</p>
<h2>Interrupts</h2>
<p>The SoMgr module is not using any interrupts.</p>
<h2>Shared Variables Analysis</h2>
<p>The analysis of the shared variables used inside this functionality can be opened <a href="https://github-vni.geo.conti.de/bs-vw-meb-19-icas1-chorus/sw.sys.chorus_main_doc/tree/master/mc_sw/cdd/Ethernet/SoMgr/c/doc/Doxygen/Shared_Variable_SoMgr.docx">here</a> .</p>
<h2>Events</h2>
<p>The events present at SoMgr level are reveived from lower layer (TcpIP) through SoMgr_TcpIpEvent:</p><ul>
<li>TCPIP_TCP_RESET <br />
</li>
<li>TCPIP_TCP_CLOSED <br />
</li>
<li>TCPIP_TCP_FIN_RECEIVED <br />
</li>
<li>TCPIP_UDP_CLOSED <br />
<br />
 <br />
The callbacks from the component are the following:</li>
<li><a class="el" href="_so_mgr___cbk_8h.html#a8641fe6f39fd32ac239714ffa80eb59e">SoMgr_RxIndication</a> - Indicates the reception of a new TCP segment or UDP datagram and provides all data and peer information via parameters. <br />
</li>
<li><a class="el" href="_so_mgr___cbk_8h.html#ad161565956e1d9d3ab9b3a71ffb4fb3f">SoMgr_CopyTxData</a> - This service requests to copy data for transmission to the indicated buffer. <br />
</li>
<li><a class="el" href="_so_mgr___cbk_8h.html#af8ead95f438278f1e90fb54d92eb6d8b">SoMgr_TxConfirmation</a> - The TCP/IP stack calls this function after the data has been acknowledged by the peer for TCP or was sent to the lower layer driver using UDP. <br />
</li>
<li><a class="el" href="_so_mgr___cbk_8h.html#a23c06726cab081eaff4ad68393326675">SoMgr_TcpAccepted</a> - Indicates an incoming TCP connection on a server socket. Callback gets called if the stack put a socket into the listen mode before (as server) and a peer connected to it (as client). <br />
</li>
<li><a class="el" href="_so_mgr___cbk_8h.html#a271cc0ca220220dc2f65e97f0998a1ef">SoMgr_TcpConnected</a> - Indicates a successful connection from client sight. <br />
</li>
<li><a class="el" href="_so_mgr___cbk_8h.html#ae4a2dfa0374da2efccdcc6d8ccd0e7ab">SoMgr_TcpIpEvent</a> - Indicates an event in the TCP/IP stack referred to the passed socket. <br />
</li>
<li><a class="el" href="_so_mgr___cbk_8h.html#a6bab0c7bcd9ae770b774f415206ebbe9">SoMgr_LocalIpAddrAssignmentChg</a> - Indicates an IP address change. This service gets called by the TCP/IP stack if an IP address changes (i.e. new address assigned or assigned address becomes invalid).</li>
</ul>
<h2>Operating Modes</h2>
<p>The Socket Manager is operating only in high-power mode, while the bus communication is ongoing. There are no dependencies with other operating mode(s).</p>
<h2>Power Modes</h2>
<p>As mentioned in above chapter, the current functionality is available only in high-power mode.</p>
<h2>Exception and Error Handling</h2>
<p>The functions are handling errors via return value (e.g. E_NOT_OK) The error handling is described in the description of each function. Also the global variable <a class="el" href="_so_mgr_8c.html#a09d036426e0cce8d48a0e21216fa47d6">SoMgr_Statistics</a> is defined and used to count when an error is detected. <br />
The error codes for SoMgr component are the following:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Error code  </th><th class="markdownTableHeadCenter">Explanation   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">SOMGR_ERR_INVALID_SOCKET_ID  </td><td class="markdownTableBodyCenter">Invalid socket id.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SOMGR_ERR_INVALID_CONNECT  </td><td class="markdownTableBodyCenter">Invalid connection.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">SOMGR_ERR_INVALID_ACCEPT  </td><td class="markdownTableBodyCenter">Error for invalid acceptance.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SOMGR_ERR_DOIP_HEADER_LENGTH  </td><td class="markdownTableBodyCenter">DoIP header length out of range.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">SOMGR_ERR_INVALID_DOIP_VERSION  </td><td class="markdownTableBodyCenter">Invalid DoIP version.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SOMGR_ERR_INVALID_DOIP_PAYLOADTYPE  </td><td class="markdownTableBodyCenter">Invalid DoIP payload.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">SOMGR_ERR_CHANGE_PARAMS_FAILED  </td><td class="markdownTableBodyCenter">Change parameters failed.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SOMGR_ERR_LOCAL_IP_ADDR_ERROR  </td><td class="markdownTableBodyCenter">Local IP address error.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">SOMGR_ERR_OPEN_FAILED  </td><td class="markdownTableBodyCenter">Open socket failed.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SOMGR_ERR_CLOSE_FAILED  </td><td class="markdownTableBodyCenter">Closed socket failed.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">SOMGR_ERR_UNKNOWN_UDP_MSG  </td><td class="markdownTableBodyCenter">Unknown UDP message.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SOMGR_ERR_UNKNOWN_TCP_MSG  </td><td class="markdownTableBodyCenter">Unknown TCP message.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">SOMGR_ERR_OUT_OF_MEMORY  </td><td class="markdownTableBodyCenter">Out of memory error.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SOMGR_ERR_TX_ERR  </td><td class="markdownTableBodyCenter">Tx error   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">SOMGR_ERR_PHYS_ADDR_MISS  </td><td class="markdownTableBodyCenter">Phisical address missed error.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SOMGR_ERR_GENERAL  </td><td class="markdownTableBodyCenter">General error.   </td></tr>
</table>
<h2>Synchronization</h2>
<p>Because the diagnose responses coming from Chorus DCM/ CAN ECUs/LIN ECUs are handled in different task (Diag TASK) there is the need to protect the sensitive data from corruption. <br />
A sollution is under analysis, see <a href="https://jira-ibs.zone2.agileci.conti.de/browse/VWICAS23-21819">[VWICAS23-21819]</a> <br />
</p>
<h2>Operations</h2>
<p>The description of the operations done by SoMgr are detailed in the header of each function. A list of methods defined inside this functionality can be accessed <a href="globals_func.html">here</a>.</p>
<h2>Macros</h2>
<p>There are no definitions of complex macros inside the functionality. Details about purpose and usage of existing macros are done inside source code. List of the currently defined macros <a href="globals_defs.html">here</a>.</p>
<h2>Algorithms</h2>
<p>The functionality doesn't make use of or implements a particular algorithm.</p>
<h2>Data Structures</h2>
<p>List of the currently defined data structures types can be seen <a href="annotated.html">here</a>.</p>
<h1><a class="anchor" id="SoftwareDesignEval"></a>
Evaluate Software Detailed Design</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Interoperability  </th><th class="markdownTableHeadLeft">Interaction  </th><th class="markdownTableHeadLeft">Criticality  </th><th class="markdownTableHeadLeft">Technical complexity  </th><th class="markdownTableHeadLeft">Risks  </th><th class="markdownTableHeadLeft">Testability   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Medium  </td><td class="markdownTableBodyLeft">Medium  </td><td class="markdownTableBodyLeft">High  </td><td class="markdownTableBodyLeft">Medium  </td><td class="markdownTableBodyLeft">High  </td><td class="markdownTableBodyLeft">Medium   </td></tr>
</table>
<h2>Interoperability</h2>
<p>Interoperability is set to <b>Medium</b> because it is required to exchange data with other components from the ICAS. </p><h2>Interaction</h2>
<p>Interaction is set to <b>Medium</b> because the number of dependencies from interfaces and dependencies equals 4. See <a class="el" href="_external_interfaces_dependencies.html">External Interfaces and Dependencies</a>. </p><h2>Criticality</h2>
<p>Criticality is set to <b>high</b> because a failure in this component can impact other functionalities which can be recognized by driver/ passenger, causing strong annoyance and it is an Communication Stack component. In addition, the functionality has a high customer visibility. </p><h2>Technical complexity</h2>
<p>Technical Complexity is set to <b>Medium</b> due to the fact that the component implements different callbacks from TCP/IP. </p><h2>Risks</h2>
<p>Risk is set to <b>High</b> because any bugs can influence the flashing of the car. </p><h2>Testability</h2>
<p>At software level the testability is set to <b>Medium</b> because input and outputs of this component cannot be manipulated/seen only at system level. Most of the requirements needs to be tested at software level without needing of a complex setup in order test it. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13, 1.8.14-->
<!-- start footer part -->
<hr class="footer"/>
<address class="footer">
  <small>
    Generated on Fri Jul 1 2022 13:46:04 for SDD_SoMgr by &#160;
    <a>
      <img class="footer" src="doxygen.png" alt="doxygen"/>
    </a>
    1.8.14<br>
    <a>
      <img class="footer" src="../conti.png" alt="continental"/>
    </a>
  </small>
</address>
</body>
</html>
